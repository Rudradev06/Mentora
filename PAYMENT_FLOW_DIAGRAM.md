# Payment Flow Diagram

## ğŸ¯ Complete Payment Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         STUDENT JOURNEY                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ‘¤ Student
     â”‚
     â”œâ”€ Browse Courses (/courses)
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CoursesPage.jsx    â”‚
â”‚                     â”‚
â”‚  [Course Card]      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ React Course  â”‚  â”‚
â”‚  â”‚ $49.99        â”‚  â”‚
â”‚  â”‚ [Buy Now]     â”‚  â”‚â—€â”€â”€â”€ Is it FREE?
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
         â”‚                      â”‚
         â”‚ YES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                      â”‚
         â–¼                      â–¼
    Direct Enroll          Checkout Flow
         â”‚
         â–¼
    Start Learning


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CHECKOUT FLOW (Paid Courses)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Click "Buy Now"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CheckoutPage.jsx   â”‚
â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Order Summary â”‚  â”‚
â”‚  â”‚ Course: $49.99â”‚  â”‚
â”‚  â”‚ Tax: $0.00    â”‚  â”‚
â”‚  â”‚ Total: $49.99 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Payment Form  â”‚  â”‚
â”‚  â”‚ [Card Number] â”‚  â”‚
â”‚  â”‚ [Expiry] [CVC]â”‚  â”‚
â”‚  â”‚ [Pay Now]     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Submit Payment
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CheckoutForm.jsx   â”‚
â”‚                     â”‚
â”‚  Stripe Elements    â”‚
â”‚  Processing...      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND PROCESSING                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend Request
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/payment/             â”‚
â”‚  create-payment-intent          â”‚
â”‚                                 â”‚
â”‚  1. Verify user is student      â”‚
â”‚  2. Check course exists         â”‚
â”‚  3. Verify not enrolled         â”‚
â”‚  4. Create Stripe Payment Intentâ”‚
â”‚  5. Save to Payment.model       â”‚
â”‚  6. Return client_secret        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stripe API                     â”‚
â”‚                                 â”‚
â”‚  Process Payment                â”‚
â”‚  - Validate card                â”‚
â”‚  - Check funds                  â”‚
â”‚  - 3D Secure (if needed)        â”‚
â”‚  - Charge card                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                    â”‚
     â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Webhook Event  â”‚  â”‚  Redirect User  â”‚
â”‚  payment_intent â”‚  â”‚  to Success     â”‚
â”‚  .succeeded     â”‚  â”‚  Page           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚
     â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/payment/webhook      â”‚
â”‚                                 â”‚
â”‚  1. Verify webhook signature    â”‚
â”‚  2. Update Payment status       â”‚
â”‚  3. Enroll student in course    â”‚
â”‚  4. Send confirmation email     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Course.model                   â”‚
â”‚                                 â”‚
â”‚  enrolledStudents.push(userId)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SUCCESS & ACCESS                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    User Redirected
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PaymentSuccess.jsx  â”‚
â”‚                     â”‚
â”‚  âœ… Payment Success!â”‚
â”‚                     â”‚
â”‚  [Start Learning]   â”‚
â”‚  [My Courses]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Click "Start Learning"
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CourseLearnPage.jsx â”‚
â”‚                     â”‚
â”‚  ğŸ“¹ Video Player    â”‚
â”‚  ğŸ“ Lesson Content  â”‚
â”‚  âœ… Mark Complete   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PAYMENT HISTORY                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    User Profile Menu
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PaymentHistory.jsx  â”‚
â”‚                     â”‚
â”‚  Transaction List   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ React Course  â”‚  â”‚
â”‚  â”‚ $49.99        â”‚  â”‚
â”‚  â”‚ âœ… Completed  â”‚  â”‚
â”‚  â”‚ [View Course] â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â”‚
â”‚  Summary Stats      â”‚
â”‚  Total: $149.97     â”‚
â”‚  Courses: 3         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ State Transitions

```
Payment Status Flow:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

pending â”€â”€â”€â”€â”€â”€â–¶ completed â”€â”€â”€â”€â”€â”€â–¶ [Student Enrolled]
   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ failed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ [Show Error]
   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ refunded â”€â”€â”€â”€â”€â”€â”€â”€â–¶ [Remove Access]
```

## ğŸ¨ User Interface Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Courses    â”‚â”€â”€â”€â”€â–¶â”‚   Checkout   â”‚â”€â”€â”€â”€â–¶â”‚   Success    â”‚
â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â”‚ [Buy Now]    â”‚     â”‚ [Pay Now]    â”‚     â”‚ [Start Learn]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ (if error)
                            â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Error Page  â”‚
                     â”‚              â”‚
                     â”‚ [Try Again]  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Security Checkpoints

```
1. Authentication Check
   â””â”€ User must be logged in
      â””â”€ User must be a student

2. Course Validation
   â””â”€ Course must exist
      â””â”€ Course must be published
         â””â”€ User not already enrolled

3. Payment Processing
   â””â”€ Stripe validates card
      â””â”€ 3D Secure if required
         â””â”€ Funds available

4. Webhook Verification
   â””â”€ Signature validation
      â””â”€ Event authenticity
         â””â”€ Idempotency check

5. Enrollment
   â””â”€ Payment confirmed
      â””â”€ Add to enrolledStudents
         â””â”€ Grant course access
```

## ğŸ“Š Data Models Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚
â”‚             â”‚
â”‚ - id        â”‚
â”‚ - name      â”‚
â”‚ - email     â”‚
â”‚ - role      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ makes
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      references      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Payment   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Course    â”‚
â”‚             â”‚                      â”‚             â”‚
â”‚ - user      â”‚                      â”‚ - title     â”‚
â”‚ - course    â”‚                      â”‚ - price     â”‚
â”‚ - amount    â”‚                      â”‚ - enrolled  â”‚
â”‚ - status    â”‚                      â”‚   Students  â”‚
â”‚ - intentId  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ triggers
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Enrollment  â”‚
â”‚             â”‚
â”‚ User added  â”‚
â”‚ to Course   â”‚
â”‚ enrolled    â”‚
â”‚ Students[]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ API Endpoints Flow

```
Frontend                          Backend                        Stripe
â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€

GET /courses
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Return courses list
                    â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

POST /payment/create-payment-intent
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Validate request
                                  Create Payment record
                                                      â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Create Intent
                                                      â—€â”€â”€â”€â”€â”€â”€â”€â”€ Return secret
                    â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Return client_secret

[User enters card]

Stripe.confirmPayment()
                                                      â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Process payment
                                                      â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Fire webhook

POST /payment/webhook
                    â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Webhook event
                                  Verify signature
                                  Update Payment
                                  Enroll student
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Return 200 OK

GET /payment/history
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Return user payments
                    â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

## ğŸ’¡ Key Features Highlighted

### 1. Free Course Path
```
Browse â†’ Click "Enroll Free" â†’ Instant Access â†’ Start Learning
```

### 2. Paid Course Path
```
Browse â†’ Click "Buy Now" â†’ Checkout â†’ Payment â†’ Success â†’ Start Learning
```

### 3. Error Handling
```
Payment Failed â†’ Show Error â†’ Retry or Cancel â†’ Back to Course
```

### 4. Payment Tracking
```
All Payments â†’ Payment History â†’ View Details â†’ Download Receipt
```

## ğŸ‰ Complete Feature Set

âœ… Browse courses (free & paid)
âœ… Instant enrollment (free courses)
âœ… Secure checkout (paid courses)
âœ… Stripe payment processing
âœ… Webhook event handling
âœ… Automatic enrollment
âœ… Payment confirmation
âœ… Transaction history
âœ… Course access control
âœ… Error handling
âœ… Loading states
âœ… Success feedback

---

**Your payment system is production-ready! ğŸš€**
